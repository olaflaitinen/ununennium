
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Production-grade Python library for satellite imagery ML">
      
      
      
        <link rel="canonical" href="https://ununennium.readthedocs.io/theory/spatial_autocorrelation/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Spatial Autocorrelation in Geospatial Deep Learning: A Theoretical Treatise - Ununennium</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spatial-autocorrelation-in-geospatial-deep-learning-a-theoretical-treatise" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ununennium" class="md-header__button md-logo" aria-label="Ununennium" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ununennium
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spatial Autocorrelation in Geospatial Deep Learning: A Theoretical Treatise
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ununennium/ununennium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ununennium/ununennium
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/core/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/segmentation.md" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../models/zoo.md" class="md-tabs__link">
        
  
  
    
  
  Model Zoo

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ununennium" class="md-nav__button md-logo" aria-label="Ununennium" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ununennium
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ununennium/ununennium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ununennium/ununennium
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/models.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/segmentation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segmentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/change_detection.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Change Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/zoo.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Zoo
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-foundations-of-spatial-dependence" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Foundations of Spatial Dependence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Foundations of Spatial Dependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-the-independent-and-identically-distributed-iid-fallacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 The Independent and Identically Distributed (i.i.d.) Fallacy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-toblers-first-law-tfl" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Tobler's First Law (TFL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-the-modifiable-areal-unit-problem-maup" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 The Modifiable Areal Unit Problem (MAUP)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-statistical-quantification-measures" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Statistical Quantification Measures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Statistical Quantification Measures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-global-morans-i" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Global Moran's \(I\)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 Global Moran&#39;s \(I\)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-formal-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1.1 Formal Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-the-spatial-weight-matrix-w" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1.2 The Spatial Weight Matrix (\(W\))
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-hypothesis-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1.3 Hypothesis Testing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-gearys-c-ratio" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Geary's \(C\) Ratio
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-getis-ord-general-g" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Getis-Ord General \(G\)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-local-indicators-of-spatial-association-lisa" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Local Indicators of Spatial Association (LISA)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Local Indicators of Spatial Association (LISA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-local-morans-i_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Local Moran's \(I_i\)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-getis-ord-g_i-gi-star" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Getis-Ord \(G_i^*\) (Gi-Star)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-variography-and-geostatistics" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Variography and Geostatistics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Variography and Geostatistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-the-experimental-variogram" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 The Experimental Variogram
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-analytical-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Analytical Models
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-key-parameters-interpretation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 Key Parameters Interpretation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-the-impact-on-cross-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. The Impact on Cross-Validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. The Impact on Cross-Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-the-bias-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 The Bias Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-block-cross-validation-blockcv" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Block Cross-Validation (BlockCV)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-buffered-block-cross-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Buffered Block Cross-Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-variance-inflation-and-effective-sample-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Variance Inflation and Effective Sample Size
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Variance Inflation and Effective Sample Size">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-effective-sample-size-n_eff" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Effective Sample Size (\(N_{eff}\))
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-deep-learning-specifics-receptive-fields-and-autocorrelation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Deep Learning Specifics: Receptive Fields and Autocorrelation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Deep Learning Specifics: Receptive Fields and Autocorrelation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-the-erf-correlation-resonance" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 The ERF-Correlation Resonance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-spatially-dependent-label-noise" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Spatially Dependent Label Noise
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-ununennium-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Ununennium Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Ununennium Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-the-ununenniumstatsautocorrelation-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 The ununennium.stats.autocorrelation Module
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-spatially-weighted-loss-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Spatially-Weighted Loss Function
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Conclusion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-references" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="spatial-autocorrelation-in-geospatial-deep-learning-a-theoretical-treatise">Spatial Autocorrelation in Geospatial Deep Learning: A Theoretical Treatise</h1>
<h2 id="abstract">Abstract</h2>
<p>Spatial autocorrelation is the defining characteristic of geospatial data, encapsulating the axiom that "near things are more related than distant things" (Tobler, 1970). In the context of Deep Learning (DL), it presents a fundamental paradox: it is the very feature that allows Convolutional Neural Networks (CNNs) to work (by exploiting local structure), yet it simultaneously invalidates the core statistical assumptions of Independent and Identically Distributed (i.i.d.) data upon which modern optimization and validation theories rest. This document provides a rigorous, comprehensive analysis of spatial autocorrelation, its mathematical quantification, its pernicious effects on error estimation, and the advanced strategies required to manage it in production-grade Earth Observation (EO) systems.</p>
<hr />
<h2 id="1-foundations-of-spatial-dependence">1. Foundations of Spatial Dependence</h2>
<h3 id="11-the-independent-and-identically-distributed-iid-fallacy">1.1 The Independent and Identically Distributed (i.i.d.) Fallacy</h3>
<p>Classical statistical learning theory assumes that a dataset <span class="arithmatex">\(D = \{(x_1, y_1), ..., (x_N, y_N)\}\)</span> consists of samples drawn independently from a joint probability distribution <span class="arithmatex">\(P(X, Y)\)</span>.</p>
<div class="arithmatex">\[ P(D) = \prod_{i=1}^N P(x_i, y_i) \]</div>
<p>This assumption simplifies the calculation of the likelihood function <span class="arithmatex">\(\mathcal{L}(\theta)\)</span> and ensures that the empirical risk converges to the expected risk as <span class="arithmatex">\(N \to \infty\)</span>.</p>
<p><strong>The Geospatial Reality:</strong>
In satellite imagery, <span class="arithmatex">\(x_i\)</span> (a pixel or patch) is functionally dependent on <span class="arithmatex">\(x_j\)</span> where distance <span class="arithmatex">\(d(i, j)\)</span> is small.
*   <strong>Atmospheric Continuity:</strong> Haze and clouds are continuous fields.
*   <strong>ecological Continuity:</strong> A forest does not end abruptly at a pixel boundary; biases in species distribution persist over kilometers.
*   <strong>Sensor Noise:</strong> CCD strips introduce row-correlated noise.</p>
<p>Consequently, the effective sample size <span class="arithmatex">\(N_{eff}\)</span> is fundamentally different from the observed sample size <span class="arithmatex">\(N\)</span>.</p>
<h3 id="12-toblers-first-law-tfl">1.2 Tobler's First Law (TFL)</h3>
<blockquote>
<p>"Everything is related to everything else, but near things are more related than distant things."
â€” Waldo Tobler, <em>A Computer Movie Simulating Urban Growth in the Detroit Region</em> (1970)</p>
</blockquote>
<p>While TFL is intuitive, its mathematical formalization leads to the concept of the <strong>Spatial Weight Matrix</strong> (<span class="arithmatex">\(W\)</span>) or the <strong>Covariance Function</strong> (<span class="arithmatex">\(C(h)\)</span>) in Geostatistics. High autocorrelation implies that the information content of new samples decays rapidly as sampling density increases within a fixed region.</p>
<h3 id="13-the-modifiable-areal-unit-problem-maup">1.3 The Modifiable Areal Unit Problem (MAUP)</h3>
<p>Spatial autocorrelation is inextricably linked to MAUP (Openshaw, 1984). The correlation observed depends on the scale and aggregation of units.
1.  <strong>Scale Effect:</strong> Correlations change as we aggregate pixels into larger patches. A strong correlation at 10m resolution (individual tree crowns) may vanish at 1km resolution (forest stand).
2.  <strong>Zoning Effect:</strong> The shape of the aggregation units (square tiles vs. hexagons vs. administrative boundaries) alters the measured statistics.</p>
<p>Ununennium addresses MAUP by enforcing <strong>resolution-invariant</strong> sampling strategies and providing <strong>multi-scale</strong> uncertainty metrics.</p>
<hr />
<h2 id="2-statistical-quantification-measures">2. Statistical Quantification Measures</h2>
<p>To mitigate autocorrelation, we first must measure it. We employ several statistics, each sensitive to different aspects of spatial structure.</p>
<h3 id="21-global-morans-i">2.1 Global Moran's <span class="arithmatex">\(I\)</span></h3>
<p>Moran's <span class="arithmatex">\(I\)</span> (Moran, 1950) is the spatial equivalent of the Pearson correlation coefficient. It measures the global tendency of similar values to cluster.</p>
<h4 id="211-formal-definition">2.1.1 Formal Definition</h4>
<div class="arithmatex">\[ I = \frac{N}{S_0} \frac{\sum_{i=1}^N \sum_{j=1}^N w_{ij} (x_i - \bar{x})(x_j - \bar{x})}{\sum_{i=1}^N (x_i - \bar{x})^2} \]</div>
<p>Where:
*   <span class="arithmatex">\(N\)</span>: Total number of spatial units (e.g., image patches).
*   <span class="arithmatex">\(x_i\)</span>: Attribute value at location <span class="arithmatex">\(i\)</span> (e.g., prediction error, class label).
*   <span class="arithmatex">\(\bar{x}\)</span>: Global mean of <span class="arithmatex">\(x\)</span>.
*   <span class="arithmatex">\(w_{ij}\)</span>: Spatial weight describing the proximity of <span class="arithmatex">\(i\)</span> and <span class="arithmatex">\(j\)</span>.
*   <span class="arithmatex">\(S_0\)</span>: Sum of all spatial weights, <span class="arithmatex">\(S_0 = \sum_{i=1}^N \sum_{j=1}^N w_{ij}\)</span>.</p>
<h4 id="212-the-spatial-weight-matrix-w">2.1.2 The Spatial Weight Matrix (<span class="arithmatex">\(W\)</span>)</h4>
<p>The choice of <span class="arithmatex">\(W\)</span> dictates the "neighborhood."
*   <strong>Contiguity Weights:</strong> <span class="arithmatex">\(w_{ij} = 1\)</span> if <span class="arithmatex">\(i\)</span> and <span class="arithmatex">\(j\)</span> share a boundary (Queen or Rook).
*   <strong>Distance Weights:</strong> <span class="arithmatex">\(w_{ij} = 1/d_{ij}^\alpha\)</span> (Inverse Distance Weighting).
*   <strong>K-Nearest Neighbors:</strong> <span class="arithmatex">\(w_{ij} = 1\)</span> if <span class="arithmatex">\(j \in \text{KNN}(i)\)</span>.</p>
<p>In deep learning, we typically use a <strong>Kernel-based Weight</strong>, typically Gaussian:</p>
<div class="arithmatex">\[ w_{ij} = \exp\left(-\frac{d_{ij}^2}{2\sigma^2}\right) \]</div>
<h4 id="213-hypothesis-testing">2.1.3 Hypothesis Testing</h4>
<p>The expected value of Moran's <span class="arithmatex">\(I\)</span> under the null hypothesis (complete spatial randomness) is:</p>
<div class="arithmatex">\[ E[I] = \frac{-1}{N-1} \]</div>
<p>As <span class="arithmatex">\(N \to \infty\)</span>, <span class="arithmatex">\(E[I] \to 0\)</span>. Values significantly greater than <span class="arithmatex">\(E[I]\)</span> indicate positive autocorrelation (clustering), while values less indicate negative autocorrelation (dispersion).</p>
<p>We calculate the Z-score for significance testing:</p>
<div class="arithmatex">\[ Z_I = \frac{I - E[I]}{\sqrt{\text{Var}(I)}} \]</div>
<p>If <span class="arithmatex">\(|Z_I| &gt; 1.96\)</span>, we reject the null hypothesis at <span class="arithmatex">\(p &lt; 0.05\)</span>. This is a critical check before trusting any grid-search or hyperparameter tuning result.</p>
<h3 id="22-gearys-c-ratio">2.2 Geary's <span class="arithmatex">\(C\)</span> Ratio</h3>
<p>Geary's <span class="arithmatex">\(C\)</span> (Geary, 1954) is based on squared differences rather than cross-products.</p>
<div class="arithmatex">\[ C = \frac{(N-1) \sum_{i=1}^N \sum_{j=1}^N w_{ij} (x_i - x_j)^2}{2 S_0 \sum_{i=1}^N (x_i - \bar{x})^2} \]</div>
<p><strong>Key Differences:</strong>
*   <strong>Range:</strong> <span class="arithmatex">\(0 \le C \le 2\)</span> (approx).
*   <strong>Interpretation:</strong>
    *   <span class="arithmatex">\(C &lt; 1\)</span>: Positive autocorrelation (similar values are close).
    *   <span class="arithmatex">\(C = 1\)</span>: Randomness.
    *   <span class="arithmatex">\(C &gt; 1\)</span>: Negative autocorrelation.
*   <strong>Sensitivity:</strong> Geary's <span class="arithmatex">\(C\)</span> is more sensitive to local deviations, whereas Moran's <span class="arithmatex">\(I\)</span> is more sensitive to global trends.</p>
<h3 id="23-getis-ord-general-g">2.3 Getis-Ord General <span class="arithmatex">\(G\)</span></h3>
<p>The General <span class="arithmatex">\(G\)</span> statistic distinguishes between "High-High" clusters (hotspots) and "Low-Low" clusters (coldspots), which Moran's <span class="arithmatex">\(I\)</span> cannot differentiate (both are just "positive").</p>
<div class="arithmatex">\[ G = \frac{\sum_{i=1}^N \sum_{j=1, j \neq i}^N w_{ij} x_i x_j}{\sum_{i=1}^N \sum_{j=1, j \neq i}^N x_i x_j} \]</div>
<hr />
<h2 id="3-local-indicators-of-spatial-association-lisa">3. Local Indicators of Spatial Association (LISA)</h2>
<p>Global statistics summarize the entire study area into a single number. However, geospatial processes are rarely stationary; relationships vary across space (Spatial Heterogeneity). LISA statistics (Anselin, 1995) decompose global measures into local contributions.</p>
<h3 id="31-local-morans-i_i">3.1 Local Moran's <span class="arithmatex">\(I_i\)</span></h3>
<div class="arithmatex">\[ I_i = z_i \sum_{j} w_{ij} z_j \]</div>
<p>Where <span class="arithmatex">\(z_i = (x_i - \bar{x}) / \sigma\)</span> is the standardized score.</p>
<p><strong>The Summation Property:</strong>
$$ \sum_{i=1}^N I_i \propto I_{global} $$</p>
<p><strong>Cluster Map Generation:</strong>
By computing <span class="arithmatex">\(I_i\)</span> for every pixel (or tile) and testing significance, we generate a LISA Cluster Map with four categories:
1.  <strong>HH (High-High):</strong> High values surrounded by high values (Hotspot).
2.  <strong>LL (Low-Low):</strong> Low values surrounded by low values (Coldspot).
3.  <strong>HL (High-Low):</strong> High value outlier in a low value field (<em>Spatial Outlier</em>).
4.  <strong>LH (Low-High):</strong> Low value outlier in a high value field (<em>Spatial Outlier</em>).</p>
<p><strong>Ununennium Use Case:</strong>
We use <strong>HL</strong> and <strong>LH</strong> regions for <strong>Hard Negative Mining</strong>. These represent unexpected features (e.g., a building in the middle of a forest, a hole in a cloud) that constitute the most informative training examples.</p>
<h3 id="32-getis-ord-g_i-gi-star">3.2 Getis-Ord <span class="arithmatex">\(G_i^*\)</span> (Gi-Star)</h3>
<p>The <span class="arithmatex">\(G_i^*\)</span> statistic is widely used for heatmap generation.</p>
<div class="arithmatex">\[ G_i^* = \frac{\sum_{j=1}^N w_{ij} x_j - \bar{X} \sum_{j=1}^N w_{ij}}{S \sqrt{\frac{N \sum_{j=1}^N w_{ij}^2 - (\sum_{j=1}^N w_{ij})^2}{N-1}}} \]</div>
<p>Unlike Local Moran, <span class="arithmatex">\(G_i^*\)</span> includes the value at <span class="arithmatex">\(i\)</span> in the summation.</p>
<hr />
<h2 id="4-variography-and-geostatistics">4. Variography and Geostatistics</h2>
<p>For continuous fields, we model spatial dependence using the <strong>Semivariogram</strong>.</p>
<h3 id="41-the-experimental-variogram">4.1 The Experimental Variogram</h3>
<div class="arithmatex">\[ \hat{\gamma}(h) = \frac{1}{2|N(h)|} \sum_{(i,j) \in N(h)} (x_i - x_j)^2 \]</div>
<p>Where <span class="arithmatex">\(N(h)\)</span> is the set of pairs separated by distance vector <span class="arithmatex">\(h\)</span> (lag).</p>
<h3 id="42-analytical-models">4.2 Analytical Models</h3>
<p>To utilize the variogram, we fit a theoretical model to the experimental points:</p>
<ol>
<li>
<p><strong>Spherical Model:</strong> Linear rise until range, then constant.
    $$ \gamma(h) = \begin{cases} c_0 + c \left( \frac{3h}{2a} - \frac{h^3}{2a^3} \right) &amp; h \le a \ c_0 + c &amp; h &gt; a \end{cases} $$</p>
</li>
<li>
<p><strong>Exponential Model:</strong> Asymptotic approach to sill.
    $$ \gamma(h) = c_0 + c \left( 1 - \exp\left(\frac{-h}{a}\right) \right) $$</p>
</li>
<li>
<p><strong>Gaussian Model:</strong> Parabolic rise (very smooth phenomena).
    $$ \gamma(h) = c_0 + c \left( 1 - \exp\left(\frac{-h^2}{a^2}\right) \right) $$</p>
</li>
</ol>
<h3 id="43-key-parameters-interpretation">4.3 Key Parameters Interpretation</h3>
<ul>
<li><strong>Nugget (<span class="arithmatex">\(c_0\)</span>):</strong> The discontinuous jump at the origin. Represents measurement error + micro-scale variation smaller than the sampling interval.</li>
<li><strong>Sill (<span class="arithmatex">\(c_0 + c\)</span>):</strong> The variance of the random field.</li>
<li><strong>Range (<span class="arithmatex">\(a\)</span>):</strong> The distance at which correlation becomes negligible.</li>
</ul>
<p><strong>Critical for Deep Learning:</strong>
The <strong>effective range</strong> determines the minimum required buffer size between training and validation chips. If you split your dataset into Train/Val with a buffer <span class="arithmatex">\(d &lt; a\)</span>, your validation score is contaminated by leakage.</p>
<hr />
<h2 id="5-the-impact-on-cross-validation">5. The Impact on Cross-Validation</h2>
<p>Standard K-Fold Cross-Validation (CV) assumes independence. In the presence of autocorrelation, random K-Fold leads to <strong>Optimism Bias</strong>.</p>
<h3 id="51-the-bias-mechanism">5.1 The Bias Mechanism</h3>
<p>Let error <span class="arithmatex">\(\epsilon \sim N(0, \Sigma)\)</span>, where <span class="arithmatex">\(\Sigma\)</span> is not diagonal (non-zero off-diagonal elements).
If <span class="arithmatex">\(i \in \text{Train}\)</span> and <span class="arithmatex">\(j \in \text{Test}\)</span> are close, <span class="arithmatex">\(\rho_{ij}\)</span> is high. The model "remembers" <span class="arithmatex">\(i\)</span> and essentially "interpolates" <span class="arithmatex">\(j\)</span> rather than "generalizing" to it.</p>
<p>Studies (e.g., Roberts et al., 2017) show that random CV can overestimate accuracy by <strong>20-30%</strong> in tasks like crop classification or biomass estimation.</p>
<h3 id="52-block-cross-validation-blockcv">5.2 Block Cross-Validation (BlockCV)</h3>
<p><strong>Algorithm:</strong>
1.  Tessellate the ROI into independent blocks <span class="arithmatex">\(B_1, ..., B_K\)</span>.
2.  Blocks must be larger than the variogram range <span class="arithmatex">\(a\)</span>.
3.  Assign entire blocks to folds.</p>
<h3 id="53-buffered-block-cross-validation">5.3 Buffered Block Cross-Validation</h3>
<p>Even with blocks, pixels at the edge of <span class="arithmatex">\(B_{train}\)</span> correlate with boundary pixels of <span class="arithmatex">\(B_{test}\)</span>.
<strong>Solution:</strong>
Remove a "Dead Zone" buffer of width <span class="arithmatex">\(R\)</span> between blocks.</p>
<div class="arithmatex">\[ \text{Buffer Width} \ge \text{Autocorrelation Range}(\gamma) \]</div>
<p>Ununennium implements <code>SpatialKFold</code> which automates this buffering logic.</p>
<hr />
<h2 id="6-variance-inflation-and-effective-sample-size">6. Variance Inflation and Effective Sample Size</h2>
<p>When data is positively autocorrelated, each new sample adds less than 1 unit of information.</p>
<h3 id="61-effective-sample-size-n_eff">6.1 Effective Sample Size (<span class="arithmatex">\(N_{eff}\)</span>)</h3>
<p>For a spatial series with autocorrelation <span class="arithmatex">\(\rho\)</span> at lag 1:</p>
<div class="arithmatex">\[ N_{eff} \approx N \frac{1 - \rho}{1 + \rho} \]</div>
<p><strong>Implication for Significance Testing:</strong>
If you have <span class="arithmatex">\(N=10,000\)</span> pixels but <span class="arithmatex">\(\rho=0.95\)</span>:
$$ N_{eff} \approx 10,000 \cdot \frac{0.05}{1.95} \approx 256 $$
Your standard error (<span class="arithmatex">\(\frac{\sigma}{\sqrt{N}}\)</span>) is vastly underestimated. This leads to <strong>Type I Errors</strong> (false positives) where we claim a model improvement is statistically significant when it is merely fitting the spatial noise.</p>
<p><strong>Correction:</strong>
All p-values in Ununennium's reporting module are computed using <span class="arithmatex">\(N_{eff}\)</span>.</p>
<hr />
<h2 id="7-deep-learning-specifics-receptive-fields-and-autocorrelation">7. Deep Learning Specifics: Receptive Fields and Autocorrelation</h2>
<p>CNNs are explicitly designed to exploit local autocorrelation via convolution operations. However, the interplay between the network's <strong>Effective Receptive Field (ERF)</strong> and the data's <strong>Spatial Correlation Length</strong> is complex.</p>
<h3 id="71-the-erf-correlation-resonance">7.1 The ERF-Correlation Resonance</h3>
<ul>
<li>
<p><strong>Case 1: ERF &lt;&lt; Correlation Length.</strong>
    The network operates entirely within a locally homogenous region. It essentially acts as a texture filter. It struggles to learn global semantics (e.g., "this texture is part of a large lake").</p>
</li>
<li>
<p><strong>Case 2: ERF &gt;&gt; Correlation Length.</strong>
    The feature map integrates uncorrelated noise. While this averages out noise (good), it may dilute sharp features.</p>
</li>
<li>
<p><strong>Case 3: ERF <span class="arithmatex">\(\approx\)</span> Correlation Length.</strong>
    Optimal. The network context matches the physical scale of the objects.</p>
</li>
</ul>
<p><strong>Architectural implication:</strong>
We must tune the depth and dilation rates of the network based on the average variogram range of the target features (e.g., average field size for crop mapping). Ununennium provides tools to calculate the <code>Mean Feature Diameter</code> to guide <code>Atrous</code> rate selection in DeepLab models.</p>
<h3 id="72-spatially-dependent-label-noise">7.2 Spatially Dependent Label Noise</h3>
<p>In EO, label noise is rarely uniform (white noise). It is usually <strong>spatially structured</strong>:
*   A cloud mask algorithm fails on an entire cloud (blob of error).
*   A lazy annotator labels a whole region loosely.</p>
<p>This <strong>structured noise</strong> is highly dangerous because a CNN can easily learn to model the spatial structure of the noise itself (e.g., "blob-like error patterns").</p>
<p><strong>Mitigation:</strong> <code>SpatialLabelSmoothing</code>. Instead of uniform smoothing <span class="arithmatex">\(\epsilon\)</span>, we smooth based on the local variance of labels in the neighborhood.</p>
<hr />
<h2 id="8-ununennium-implementation-details">8. Ununennium Implementation Details</h2>
<h3 id="81-the-ununenniumstatsautocorrelation-module">8.1 The <code>ununennium.stats.autocorrelation</code> Module</h3>
<p>We provide optimized, CUDA-accelerated implementations of Moran's I and Geary's C.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">moran_index</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">weights</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">reduction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="sd">    Computes Global Moran&#39;s I for a batch of spatial tensors.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="sd">        tensor: Input tensor (B, C, H, W)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">        weights: Spatial weight matrix (N, N). If None, </span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="sd">                 a Gaussian kernel is computed on the fly.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="sd">    ...</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="c1"># 1. Standardize (Z-score)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">mean</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">var</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">tensor</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="c1"># 2. Compute W * Z (Spatial Lag)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="c1"># Implemented via convolution for speed on grids</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">kernel</span> <span class="o">=</span> <span class="n">_generate_gaussian_kernel</span><span class="p">()</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">z_lag</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="c1"># 3. Compute I = (Z * Z_lag).sum / Z^2.sum</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">z_lag</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span> <span class="o">*</span> <span class="n">numerator</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">)</span>
</code></pre></div>
<h3 id="82-spatially-weighted-loss-function">8.2 Spatially-Weighted Loss Function</h3>
<p>To counter the redundancy of autocorrelated samples, we re-weight the loss function using the inverse of Local Moran's <span class="arithmatex">\(I\)</span>.</p>
<div class="arithmatex">\[ \mathcal{L}_{final} = \frac{1}{B H W} \sum_{b,h,w} \omega_{bhw} \cdot \ell(y_{bhw}, \hat{y}_{bhw}) \]</div>
<div class="arithmatex">\[ \omega_{bhw} \propto \frac{1}{|I_i| + \epsilon} \]</div>
<ul>
<li><strong>High <span class="arithmatex">\(I_i\)</span> (Redundant):</strong> <span class="arithmatex">\(\omega \to 0\)</span>. The model learns less from highly clustered, repetitive data.</li>
<li><strong>Low <span class="arithmatex">\(I_i\)</span> (Unique):</strong> <span class="arithmatex">\(\omega \to 1\)</span>. The model focuses on edges, transitions, and outliers.</li>
</ul>
<hr />
<h2 id="9-conclusion">9. Conclusion</h2>
<p>Spatial autocorrelation is not a nuisance to be ignored, but a fundamental property of the physical world. Ignoring it leads to:
1.  <strong>Leaked Test Sets:</strong> Overestimated performance.
2.  <strong>Inefficient Sampling:</strong> Wasted compute on redundant data.
3.  <strong>Biased Models:</strong> Failure to generalize to new geographies.</p>
<p>By explicitly modeling autocorrelation via the Variogram, employing Block Cross-Validation, and using Spatially-Weighted Losses, Ununennium ensures that the "State-of-the-Art" metrics reported are not just statistical artifacts, but real-world capability.</p>
<hr />
<h2 id="10-references">10. References</h2>
<ol>
<li><strong>Tobler, W. R. (1970).</strong> "A Computer Movie Simulating Urban Growth in the Detroit Region". <em>Economic Geography</em>, 46(sup1), 234-240.</li>
<li><strong>Moran, P. A. P. (1950).</strong> "Notes on Continuous Stochastic Phenomena". <em>Biometrika</em>, 37(1/2), 17-23.</li>
<li><strong>Geary, R. C. (1954).</strong> "The Contiguity Ratio and Statistical Mapping". <em>The Incorporated Statistician</em>, 5(3), 115-145.</li>
<li><strong>Openshaw, S. (1984).</strong> <em>The Modifiable Areal Unit Problem</em>. CATMOG 38. Norwich: Geo Books.</li>
<li><strong>Anselin, L. (1995).</strong> "Local Indicators of Spatial Associationâ€”LISA". <em>Geographical Analysis</em>, 27(2), 93-115.</li>
<li><strong>Roberts, D. R., et al. (2017).</strong> "Cross-validation strategies for data with temporal, spatial, hierarchical, or phylogenetic structure". <em>Ecography</em>, 40(8), 913-929.</li>
<li><strong>Wadoux, A., et al. (2021).</strong> "Spatial sampling design for machine learning inference of soil properties". <em>Geoderma</em>, 385, 114890.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>